<div class="panel panel-warning">
  <div class="panel-heading">
    <h2>发货报表</h2>
    包括发货总量,实际发货,以及被拒收总量
  </div>
  <div class="panel-body">
    <br/>

    <div>
      <form method="get" action="<%= reports_removal_report_path %>">
        <div>
          <div>
            <span>地点:
              <%= select_tag(:location_id, options_for_select(Location.all.collect { |l| [l.name, l.id] }, @location_id), include_blank: false) %>
            </span>
            <span>时间范围:
              <input type="text" name="received_date_start" class="datepicker" value="<%= @received_date_start %>"/>
              ~ <input type="text" name="received_date_end" class="datepicker" value="<%= @received_date_end %>"/>
            </span>
            <span>报表类型:
              <%= select_tag(:type, options_for_select([["发货总量","total"],["实际发货","send"],["被拒收总量","rejected"]], @type), include_blank: false) %>
            </span>
            <input type="submit" value="查找" class="btn btn-info"/>
          </div>
        </div>
      </form>
    </div>
    <br/>

    <div>
      <%= link_to "导出CSV",reports_removal_download_path(:received_date_start => @received_date_start,:received_date_end=>@received_date_end,:location_id => @location_id,:type=>@type,:format => 'csv'),:class=>"btn btn-warning" %>
      <%= link_to "导出Excel",reports_removal_download_path(:received_date_start => @received_date_start,:received_date_end=>@received_date_end,:location_id => @location_id,:type=>@type,:format => 'xls'),:class=>"btn btn-warning" %>
    </div>
    <table class="table table-striped table-condensed table-hover">
      <thead>
      <tr>
        <th>No.</th>
        <th>零件号</th>
        <th>总数</th>
        <th>箱数</th>
        <th>部门</th>
        <th>运单号</th>
        <th>发货时间</th>
        <th>发货人</th>
        <th>是否被拒收</th>
      </tr>
      </thead>
      <tbody>
      <% @packages.all.each_with_index do |p, index| %>
          <tr class=<%="danger" if p.state == PackageState::DESTINATION%>>
            <td><%= index+1 %></td>
            <td><span class="label label-info"><%= p.part_id %></span></td>
            <td><span class="badge"><%= p.total%></span></td>
            <td><span class="badge"><%= p.box_count %></span></td>
            <td><%= p.whouse_id %></td>
            <td><span class="label label-info"><%= p.did %></span></td>
            <td><%= p.ddate.localtime.to_formatted_s(:db) if p.ddate%></td>
            <td>
              <%if u = User.find_by_id(p.sender_id)%>
              <%= u.name %>
              <%end%>
            </td>
            <td><%= p.state == PackageState::DESTINATION ? "是":"否"%></td>
          </tr>
      <% end %>
      </tbody>
    </table>
  </div>
</div>

<script>
    $(function () {
        $(".datepicker").datetimepicker({
            lang: 'ch',
            format: 'Y-m-d H:i'
        });
    });
    init_check();
</script>
